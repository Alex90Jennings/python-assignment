<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Employee Table</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:hover {
            background-color: #f5f5f5;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Employees</h1>
    <button onclick="location.href='/'">Back to Main Menu</button>

    <label for="filterField">Filter Field:</label>
    <select id="filterField" onchange="updateFilterOptions()">
        <option value="all">All</option>
        <option value="isVerified">Verified</option>
        <option value="preferredLanguage">Language</option>
        <option value="numberOfEsims">Number of eSIMs</option>
    </select>

    <label for="filterType" style="display: none;">Filter Type:</label>
    <select id="filterType" style="display: none;"></select>

    <label for="filterValue" style="display: none;">Filter Value:</label>
    <input type="text" id="filterValue" style="display: none;" oninput="filteremployees()">

    <table id="employeesTable">
        <thead>
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Email</th>
                <th>Is Full Time?</th>
                <th>Is Active?</th>
                <th>Salary (Â£)</th>
                <th>Annual Leave Days</th>
                <th>Diet Preferences</th>
                <th>Phone Number</th>
                <th>Date Of Birth</th>
            </tr>
        </thead>
        <tbody id="employeesTableBody">
            <!-- Rows will be inserted here by JavaScript -->
        </tbody>
    </table>

    <script>
        const employees = [
            {% for employee in employees %}
                {
                    firstName: "{{ employee.firstName }}",
                    lastName: "{{ employee.lastName }}",
                    email: "{{ employee.email }}",
                    isFullTime: "{{ employee.isFullTime }}",
                    isActive: "{{ employee.isActive }}",
                    salary: "{{ employee.salary }}",
                    annualLeaveDays: "{{ employee.annualLeaveDays }}",
                    dietPreferences: "{{ employee.dietPreferences }}",
                    phoneNumber: "{{ employee.phoneNumber }}",
                    dateOfBirth: new Date("{{ employee.dateOfBirth }}")
                },
            {% endfor %}
        ];

        function formatDate(date) {
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0'); // Months are zero-based
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        function renderemployeesTable() {
            const tableBody = document.getElementById('employeesTableBody');
            tableBody.innerHTML = '';

            employees.sort((a, b) => b.createdAt - a.createdAt);

            employees.forEach(employee => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${employee.firstName}</td>
                    <td>${employee.lastName}</td>
                    <td>${employee.email}</td>
                    <td>${employee.isFullTime}</td>
                    <td>${employee.isActive}</td>
                    <td>${employee.salary}</td>
                    <td>${employee.annualLeaveDays}</td>
                    <td>${employee.dietPreferences}</td>
                    <td>${employee.phoneNumber}</td>
                    <td>${formatDate(employee.dateOfBirth)}</td>
                `;
                row.addEventListener('click', () => {
                    window.location.href = `employee-details?email=${employee.email}`;
                });
                tableBody.appendChild(row);
            });
        }

        function updateFilterOptions() {
            var field = document.getElementById('filterField').value;
            var filterType = document.getElementById('filterType');
            var filterValueLabel = document.getElementById('filterValue');
            var filterValueInput = document.getElementById('filterValue');
            var filterTypeLabel = document.getElementById('filterType').previousElementSibling;

            filterType.style.display = 'none';
            filterTypeLabel.style.display = 'none';
            filterValueInput.style.display = 'none';
            filterValueLabel.style.display = 'none';
            filterType.innerHTML = '';

            if (field === 'isVerified') {
                filterType.style.display = 'block';
                filterTypeLabel.style.display = 'block';
                filterType.innerHTML = `
                    <option value="equals">Equals</option>
                `;
                filterValueLabel.style.display = 'block';
                filterValueInput.style.display = 'block';
                filterValueInput.setAttribute('type', 'text');
                filterValueInput.value = '';
            } else if (field === 'numberOfEsims') {
                filterType.style.display = 'block';
                filterTypeLabel.style.display = 'block';
                filterType.innerHTML = `
                    <option value="equals">Equals</option>
                    <option value="greater">Greater than</option>
                    <option value="less">Less than</option>
                `;
                filterValueLabel.style.display = 'block';
                filterValueInput.style.display = 'block';
                filterValueInput.setAttribute('type', 'number');
                filterValueInput.value = '';
            } else if (field === 'preferredLanguage') {
                filterType.style.display = 'block';
                filterTypeLabel.style.display = 'block';
                filterType.innerHTML = `
                    <option value="equals">Equals</option>
                `;
                filterValueLabel.style.display = 'block';
                filterValueInput.style.display = 'block';
                filterValueInput.setAttribute('type', 'text');
                filterValueInput.value = '';
            }
        }

        function filteremployees() {
            var field = document.getElementById('filterField').value;
            var type = document.getElementById('filterType').value;
            var value = document.getElementById('filterValue').value;
            var rows = document.querySelectorAll('#employeesTable tbody tr');

            rows.forEach(function(row) {
                var isVerified = row.querySelector('td:nth-child(4)').textContent === 'True';
                var language = row.querySelector('td:nth-child(6)').textContent;
                var esimCount = parseInt(row.querySelector('td:nth-child(7)').textContent);

                row.style.display = ''; // Reset display for all rows

                if (field === 'isVerified') {
                    var filterValue = value.toLowerCase() === 'true';
                    if (type === 'equals' && isVerified !== filterValue) {
                        row.style.display = 'none';
                    }
                } else if (field === 'preferredLanguage') {
                    if (type === 'equals' && language.toLowerCase() !== value.toLowerCase()) {
                        row.style.display = 'none';
                    }
                } else if (field === 'numberOfEsims') {
                    var filterValue = parseInt(value);
                    if (type === 'equals' && esimCount !== filterValue) {
                        row.style.display = 'none';
                    } else if (type === 'greater' && esimCount <= filterValue) {
                        row.style.display = 'none';
                    } else if (type === 'less' && esimCount >= filterValue) {
                        row.style.display = 'none';
                    }
                }
            });
        }

        window.onload = renderemployeesTable;
    </script>
</body>
</html>
